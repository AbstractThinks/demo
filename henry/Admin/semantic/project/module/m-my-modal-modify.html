<link rel="import" href="../module/my-select-school.html" media="screen" title="no title">
<link rel="import" href="../module/my-select-subject.html" media="screen" title="no title">
<dom-module id="my-modal-modify">
  <template >
      <div class="header">员工信息</div>
      <div class="content">
          <div class="ui form">
            <div class="fields">
                <div class="eight wide field">
                    <label>姓名</label>
                    <input class="username" type="text" placeholder="姓名" name="username" value="{{staff.name::input}}">
                </div>
                <div class="eight wide field">
                    <label>编号</label>
                    <input class="staffNum" type="text" placeholder="编号" name="staffNum" value="{{staff.staffNum::input}}">
                </div>
            </div>
            <div class="fields">
              <my-select-school class="eight wide field">
              </my-select-school>
              <my-select-subject class="eight wide field">
              </my-select-subject>
            </div>
            <!-- <div class="fields">
              <div class="eight wide field">
                  <label>账号</label>
                <input type="text" placeholder="">
              </div>
              <div class="eight wide field">
                  <label>密码</label>
                <input type="text" placeholder="">
              </div>
            </div> -->
          </div>
      </div>
      <div class="actions">
        <button class="ui button basic save medium" on-click="handleConfirm">&nbsp;&nbsp;<i class="add circle icon"></i> 确认 &nbsp;&nbsp;</button>
        <!-- <button class="ui button basic reset medium">&nbsp;&nbsp;<i class="minus square icon"></i>重置 &nbsp;&nbsp;</button> -->
        <button class="ui cancel button basic medium">&nbsp;&nbsp;<i class="remove circle icon"></i>取消 &nbsp;&nbsp;</button>
      </div>
  </template>
  <script type="text/javascript">
          Polymer({
                  is : "my-modal-modify",
                  properties : {
                     userid: String,
                     staff: Object
                  },
                  handleConfirm: function () {

                      var that = this;
                      var schoolId = parseInt($('.my-modal-modify .my-select-school .item.active.selected').data('value'));
                      var teachingSubject = parseInt($('.my-modal-modify .my-select-subject .item.active.selected').data('value'));
                      this.staff.schoolId = schoolId;
                      this.staff.teachingSubject = teachingSubject;
                      var urlReq = "http://k12.iyunbei.com/api/staff/"+that.staff.id;
                      $.ajax({
                          url:urlReq,
                          type: 'post',
                          data: this.staff,
                          dataType:"json",
                          cache: false,
                          success: function (data) {
                              if (data.error) {

                              } else {
                                  $('#my-table').get(0).setAttribute("updatedata", data);
                                  $('.ui.modal').modal('hide');
                              }
                          },
                          error: function (e) {
                              console.log(e)
                          }
                      });
                  },
                  attributeChanged: function(attrName, oldVal, newVal) {
                      var that = this;
                      if (attrName === "userid") {
                          var reqUrl = "http://k12.iyunbei.com/api/staff/"+newVal;
                          $.ajax({
                                url:reqUrl,
                                type: 'get',
                                // data: {name:username,staffNum:staffNum,schoolId:schoolId,teachingSubject:teachingSubject},
                                dataType:"json",
                                cache: false,
                                success: function (data) {
                                    if (data.error) {

                                    } else {
                                        that.staff = data;
                                        $(".my-modal-modify .my-select-school div[data-value='"+that.staff.schoolId+"']").addClass('active selected');
                                        $(".my-modal-modify .my-select-school div.text").removeClass('default').text($(".my-modal-modify .my-select-school div[data-value='"+that.staff.schoolId+"']").text());
                                        $(".my-modal-modify .my-select-subject div[data-value='"+that.staff.teachingSubject+"']").addClass('active selected');
                                        $(".my-modal-modify .my-select-subject div.text").removeClass('default').text($(".my-modal-modify .my-select-subject div[data-value='"+that.staff.schoolId+"']").text());                                    }
                                },
                                error: function (e) {
                                    console.log(e)
                                }
                            });
                      }

                  },
                  ready: function () {
                    //   console.log($('input[type="checkbox"]:checked').attr('value'));
                  }
          });
  </script>
</dom-module>
