<dom-module id="my-tab-update">
  <template >
          <content></content>
          <form class="ui form">
                  <div class="ui internally celled grid">
                          <div class="row">
                                  <div class="sixteen wide column">
                                          <div class="field row">
                                                  <div class="field">
                                                          <label>标题</label>
                                                          <input id="filename" type="text" placeholder="标题" name="filename">
                                                  </div>
                                          </div>

                                          <div class="field row">
                                                  <div class="field">
                                                          <label>类别</label>
                                                          <select class="ui class dropdown">
                                                                  <option value="">类别</option>
                                                                  <option value="1">视频</option>
                                                                  <option value="3">课件</option>
                                                                  <option value="3">试卷</option>
                                                                  <option value="3">资料</option>
                                                          </select>
                                                  </div>
                                          </div>
                                          <div class="field row">
                                                  <div class="field">
                                                          <label>科目</label>
                                                          <select class="ui subject dropdown">
                                                                  <option value="">科目</option>
                                                                  <option value="1">语文</option>
                                                                  <option value="2">数学</option>
                                                                  <option value="5">英语</option>
                                                          </select>
                                                  </div>
                                          </div>
                                          <div class="field row">
                                                  <div class="field">
                                                          <label>年级</label>
                                                          <select class="ui grade dropdown">
                                                                  <option value="">年级</option>
                                                                  <option value="1">高一</option>
                                                                  <option value="2">高二</option>
                                                                  <option value="3">高三</option>
                                                          </select>
                                                  </div>
                                          </div>

                                          <div class="field row">
                                                  <label>描述</label>
                                                  <textarea id="desc" name="desc"></textarea>
                                          </div>
                                          <div class="field row">
                                                  <div id="file-upload"></div>
                                          </div>
                                          <div class="ui large buttons">
                                                  <a class="ui button" on-click="handleSaveData">保存</a>
                                                  <div class="or teal"></div>
                                                  <a class="ui button">重置</a>
                                          </div>
                                  </div>
                          </div>
                  </div>
          </form>
  </template>
  <script type="text/javascript">
          Polymer({
                  is : "my-tab-update",
                  handleSaveData: function (e) {
                      var data = {};
                      data.fileId = $("#uploadedWork").attr('fileId');
                      data.resourceTypeId =$('.ui.class.dropdown .item.active.selected').data('value');
                      data.subjectId = $('.ui.subject.dropdown .item.active.selected').data('value');
                      data.gradeId = $('.ui.grade.dropdown .item.active.selected').data('value');
                      data.resourceName = $("#filename").val();
                      data.desc = $('#desc').val();
                      $.ajax({
                          url:"http://k12.iyunbei.com/api/resources/resourceUpload",
                          type: 'post',
                          data: data,
                          dataType:"json",
                          cache: false,
                          success: function (data) {
                              if (data.error) {

                              } else {
                                 console.log(data)
                              }
                          },
                          error: function (e) {
                              console.log(e)
                          }
                      });
                  },
                  ready : function () {
                      var fileUpload = $("#file-upload").semanticFileUploader({
                         defaultText: "上传文件",
                         defaultLabel: "点击选择文件或者将文件拖入此区域",
                         loadingText: "上传文件中...",
                         successText: "上传成功",
                         onDrop: function(file){
                                 //File object => https://developer.mozilla.org/en-US/docs/Web/API/File
                                 // console.log(file.name);

                                 var formData = new FormData($('#uploadForm')[0]);
                                 var name = $("input").val();
                                 formData.append("file",file);
                                 formData.append("name",name);
                                 $.ajax({
                                     url : 'http://k12.iyunbei.com/api/resources/fileUpload',
                                     type : 'post',
                                     data : formData,
                                     async: true,
                                     cache: false,
                                     // 告诉jQuery不要去处理发送的数据
                                     processData : false,
                                     // 告诉jQuery不要去设置Content-Type请求头
                                     contentType : false,
                                     beforeSend:function(){
                                         console.log("正在进行，请稍候");
                                     },
                                     success : function(responseStr) {
                                         fileUpload.uploadFinished($("#file-upload"));
                                         $("#uploadedWork").attr('fileId', responseStr);
                                     },
                                     error : function(responseStr) {
                                         console.log("error "+responseStr);
                                     }
                                 });
                                 // $('#uploadForm').submit();

                         }
                     });  
                  }
          });
  </script>
</dom-module>
